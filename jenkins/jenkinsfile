pipeline {
     agent any
 stages {
stage ("test")
{
steps {
 env.TRELLO_API_KEY
    env.TRELLO_TOKEN
}
}
        stage('Running collection') {
            steps {
 def url = "https://api.trello.com/1/members/me/boards?key=${apiKey}&token=${token}"

                sh 'newman --version'
                sh 'newman run a_TrelloAPI.postman_collection.json -e Trelloenv.postman_environment.json --disable-unicode --reporters cli,htmlextra,junit --reporter-htmlextra-export newman/report.html --reporter-junit-export newman/report.xml'
            }
        }
}
        post {
        always {
            publishHTML target: [
                reportName: 'Newman',
                reportDir: 'newman',
                reportFiles: 'report.html',
                reportTitles: 'Postman API tests',
                keepAll: true,
                alwaysLinkToLastBuild: true,
                allowMissing: false
            ]
           junit skipPublishingChecks: true, testResults: 'newman/report.xml'

        }
    }
    
}

